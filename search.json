[
  {
    "objectID": "indices-and-data.html",
    "href": "indices-and-data.html",
    "title": "quarto-project",
    "section": "",
    "text": "PREDICTS\n\ndata.nhm.ac.uk/dataset/the-2016-release-of-the-predicts-database\n\nsame study must measure something at least 2 points (either over sites or times)\n\n\nBiodiversity Intactness Index\n\nBII is defined as the average abundance, across a large and functionally diverse set of species, relative to their reference populations\n\nFirst proposed in Science (2015), first data-based estimate in Science, (2016) (based on PREDICTS)\n\nhttps://geobon.org/ebvs/indicators/local-biodiversity-intactness-index/\nhttps://adrianadepalma.github.io/BII_tutorial/bii_example.html\nhttps://data.nhm.ac.uk/dataset/bii-bte\n\nhttps://data.nhm.ac.uk/dataset/07f701d4-9a26-403c-a9d6-248c895fa412/resource/2876792f-98d9-4a8d-beee-7dc3e572e2b1/package?id=bii-bte&package_type=dataset&destination=https%3A%2F%2Fdata.nhm.ac.uk%2Fdataset%2Fbii-bte\n\n\nLiving Planet Index\n\nhttps://dx.doi.org/10.6084/m9.figshare.4300022.v1\n\n\n\nBioTME\n\nhttps://biotime.st-andrews.ac.uk/getFullDownload.php\n\nhttps://biotime.st-andrews.ac.uk/downloads/BioTIMEQuery_24_06_2021.zip\nhttps://biotime.st-andrews.ac.uk/downloads/BioTIMEMetadata_24_06_2021.csv\nhttps://biotime.st-andrews.ac.uk/downloads/BioTIMECitations_24_06_2021.csv\n\nhttps://zenodo.org/record/5026943#.Y-6JzxzMJhE\n\n\n\nGPDD\n\n\nBIEN\nTRY"
  },
  {
    "objectID": "LPI.html",
    "href": "LPI.html",
    "title": "quarto-project",
    "section": "",
    "text": "LPD data\nFill out form to download from https://www.livingplanetindex.org/data_portal . Link below will expire after some time.\n\nlibrary(tidyverse)\nlibrary(scales)\n\nStarting with the underlying living planet database, a collection of ‘abundance’ metrics from various studies across various taxa:\n\n# Goodness people with the zip, csv.gz is a streamable format for the COMPRESS algo...\n#download.file(\"https://www.livingplanetindex.org/session/542bd1f690c385d08a5eceec1dfc09b6/download/download_alldata?w=\", \"lpd.zip\")\n#archive::archive_extract(\"lpd.zip\")\n#lpd <- read_csv(\"LivingPlanetIndex_2022_PublicData/LPD2022_public.csv\")\n#write_csv(lpd, \"data/lpd.csv.gz\")\n\n\n# using cached version from above...\nlpd <- read_csv(\"data/lpd.csv.gz\") |>\n  pivot_longer(matches(\"\\\\d{4}\"), names_to=\"year\", values_to = \"abundance_metric\") |>\n  mutate(abundance_metric = as.numeric(abundance_metric),\n         year = as.numeric(year)) |>\n  filter(!is.na(abundance_metric)) |>\n  distinct()\n\n# counts are not really abundances but oh well...\nlpd |> count(Method, sort=TRUE)\n\n# A tibble: 3,664 × 2\n   Method                                                                      n\n   <chr>                                                                   <int>\n 1 Shorebird count area survey                                             69910\n 2 Volunteer survey of set routes during peak breeding season              52419\n 3 Road count - breeding birds                                             24796\n 4 Gill net                                                                20268\n 5 Trawl data from demersal (groundfish) research trawl surveys. Only dat… 13107\n 6 Unknown                                                                 11318\n 7 Large-scale monitoring with standardised methods                         5793\n 8 Annual road count - breeding birds                                       4053\n 9 SPA                                                                      4021\n10 count of individuals                                                     3932\n# … with 3,654 more rows\n\n# biodiversity data is usually mostly bird data\nlpd |> count(year,Class) |>\n  ggplot(aes(year, n)) + geom_col(aes(fill=Class))\n\n\n\n# some 4016 distinct citations, though not all entirely distinct\nlpd |> count(Citation, sort=TRUE)\n\n# A tibble: 4,014 × 2\n   Citation                                                                    n\n   <chr>                                                                   <int>\n 1 \"Environment Canada (2015). \\\"North American Breeding Bird Survey - Ca… 67316\n 2 \"Threatened Species Index data portal: BLA (2020). Shorebirds 2020. Bi… 47735\n 3 \"Threatened Species Index data portal: QWSG (2020). Queensland Wader S… 22372\n 4 \"ESBR; Naturae Consultoria Ambiental (2020) 1º RELATÓRIO ANUAL - Licen… 20268\n 5 \"Environment Canada (2014). \\\"North American Breeding Bird Survey - Ca… 13058\n 6 \"Brown, S. K., R. Mahon, K. C. T. Zwanenburg, K. R. Ruja, L. W. Clafli… 12402\n 7 \"RAM Legacy Stock Assessment Database (2021) ‘RAM Legacy Stock Assessm…  9408\n 8 \"EBCC/BirdLife/RSPB/CSO (2021) Trends of common birds in Europe, 2021 …  5807\n 9 \"Myers, R. Ransom Myers' Stock Recruitment Database.\"                    5236\n10 \"RAM Legacy RAM Legacy Stock Assessment Data Base version 3.0.\"          4806\n# … with 4,004 more rows\n\n\nObviously plenty to unpack here, though perhaps most relevant would be a deeper dive into the various citations to get a better sense of how these populations are chosen (i.e. few papers are published which describe a population abundance that is simply steady over the length of the survey, though some explicitly monitoring-based surveys do. The collection is a mix of academic journal sources and some more explicit assessments.)\nJust for fun, we can grab the index data and re-create the biodiversity stripes. The rpli package documentation + code includes more information on how the index is calculated. The choice of the geometric mean used in the definition, among other assumptions, is probably far less than ideal…\n\n# Index alone\n\n# Download from <https://www.livingplanetindex.org/latest_results>\n# download.file(\"https://www.livingplanetindex.org/session/2b05d50635fc20f864a9b0898b27da36/download/downloadData?w=\", \"data/lpi.csv\")\nlpi <- read_csv(\"data/lpi.csv\")\nset.seed(1234)\n\n\nlpi |> \n  rename(year = Year) |> \n  mutate(sample = LPI_final + ((CI_high - CI_low)/2) * (runif(n(), -10,10))/10 ) |>\n  ggplot(aes(year, LPI_final)) + geom_line() + geom_ribbon(aes(ymin=CI_low, ymax=CI_high), fill=\"blue\", alpha=0.1) +\n  geom_point(aes(year, sample, col=sample), size=5) +\n  scale_color_stepsn(colors = c(low=\"#c7cca5\", mid=\"#ddff03\", high=\"#53de02\"),\n                    values = rescale(c(min(lpi$LPI_final), 0.65, max(lpi$LPI_final))),\n                    n.breaks = 30)\n\n\n\n# color bars are based on random draws from distribution\nlpi |> \n  rename(year = Year) |> \n  mutate(sample = LPI_final + ((CI_high - CI_low)/2) * (runif(n(), -10,10))/10 ) |> \n  drop_na() |>\n  ggplot(aes(x = year, y = 1, fill = sample)) +\n  geom_tile(show.legend = FALSE) +\n  #scale_fill_steps2(low = \"#c7cca5\", mid=\"#ddff03\", high=\"#53de02\", midpoint = median(lpi_df$LPI_final)) + \n  scale_fill_stepsn(colors = c(low=\"#c7cca5\", mid=\"#ddff03\", high=\"#53de02\"), values = rescale(c(min(lpi$LPI_final), .7, max(lpi$LPI_final))),\n                    n.breaks = 30) + \n  coord_cartesian(expand=FALSE) +\n  scale_x_continuous(breaks=seq(1970, 2020, 49)) +\n  labs(title= \"Living Planet Index\") +\n  theme_void() +\n  theme(\n    axis.text.x = element_text(color=\"white\",\n                               margin =margin(t=5, b=10, unit=\"pt\")),\n    plot.title = element_text(color=\"white\",\n                              margin =margin(b=5, t=10, unit=\"pt\"),\n                              hjust= 0.05),\n    plot.background = element_rect(fill=\"black\")\n  )"
  },
  {
    "objectID": "notes.html",
    "href": "notes.html",
    "title": "quarto-project",
    "section": "",
    "text": "Population data appears to be mostly (~ 90%) count data, not abundance estimates\n\nlibrary(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   1.0.0 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\ndf <- read_csv(\"https://figshare.com/ndownloader/files/7012670\")\n\nRows: 11067 Columns: 94\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (90): Binomial, Reference, Class, Order, Family, Genus, Species, Subspec...\ndbl  (4): ID, Latitude, Longitude, Specific_location\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ndf |> count(Units, sort=TRUE)\n\n# A tibble: 1,742 × 2\n   Units                                    n\n   <chr>                                <int>\n 1 Number of individuals                 1052\n 2 Individuals                            774\n 3 Annual index of abundance              398\n 4 number of individuals                  218\n 5 Number of breeding pairs               212\n 6 Number of individuals per 100 hours.   180\n 7 Pairs                                  177\n 8 Nests                                  166\n 9 Breeding pairs                         132\n10 Number of nests                        123\n# … with 1,732 more rows\n\ndf |> mutate(abundance = grepl(\"[Aa]bundance\", Units)) |> count(abundance)\n\n# A tibble: 2 × 2\n  abundance     n\n  <lgl>     <int>\n1 FALSE     10025\n2 TRUE       1042\n\n\nGreatest number of species (rows) come from {Sauer, 2012 #3261}, which I think must be https://doi.org/10.3996/nafa.79.0001. This is actually abundance data (birds), though most other examples are all pure counts. Studies are supposed to control for sampling methodology, thus supposedly justifying the assumption on average that trends in counts are trends in abundance."
  },
  {
    "objectID": "biotime.html",
    "href": "biotime.html",
    "title": "quarto-project",
    "section": "",
    "text": "library(tidyverse)"
  },
  {
    "objectID": "biotime.html#some-random-exploration",
    "href": "biotime.html#some-random-exploration",
    "title": "quarto-project",
    "section": "Some random exploration",
    "text": "Some random exploration\nNote that species names are far from reliable and agreed-upon identifiers. Taxonomy is hard - nearly half of the biotime species are not easily resolved against Catalog of Life names:\n\nlibrary(taxadb)\ncol <- taxadb::taxa_tbl(\"col\")\nsp <- biotime |> distinct(GENUS_SPECIES) |> pull(GENUS_SPECIES)\ncol_matches <- col |> filter(scientificName %in% sp) |> collect()"
  },
  {
    "objectID": "biotime.html#an-example-study-wihtin-biotime",
    "href": "biotime.html#an-example-study-wihtin-biotime",
    "title": "quarto-project",
    "section": "an example study wihtin BioTIME",
    "text": "an example study wihtin BioTIME\nJust grabbing the first study listed in BioTIME, https://doi.org/10.1890/0012-9658(2001)082[0893:WDWPDT]2.0.CO;2 to get a concrete example of what is going on. Here we find 25 species of trees measured at three time points over 12 years across 19 plots. We see trends in abundance over this interval, but what conclusion should we draw from this? The original paper seems to have a detailed understanding of these dynamics in response to windfall events and stand evolution…\n\ntrees <- biotime |> filter(STUDY_ID == 10) |> collect()\ntrees <- trees |> mutate(control = grepl(\"Control\", SAMPLE_DESC)) # not really clear what makes a sample control or windfall, not a patch-level property\n\ntrees |> group_by(GENUS_SPECIES, YEAR, control) |> summarise(count = sum(sum.allrawdata.ABUNDANCE), .groups=\"drop\") |>\n  ggplot(aes(YEAR, count, col=GENUS_SPECIES)) + geom_point() + geom_line() + scale_y_log10() + facet_wrap(~control)"
  }
]